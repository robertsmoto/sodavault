{% extends 'cmsapp/forms/base.html' %}
{% load static %}
{% block css_links %}
<link href="{% static 'css/select2.min.css' %}" rel="stylesheet" />
{% comment %}<link href="{% static 'css/chosen.css' %}" rel="stylesheet"/>{% endcomment %}
{% endblock %}
{% block header %}
<script type="text/javascript" src="{% static 'js/ckeditor.js' %}"></script>
{% endblock %}
{% block warning %}{% endblock %}
{% block base_content %}
<div class="mt-3">
  <a 
    class="btn" 
    style="color:white; background-color:#5500aa;"
    data-bs-toggle="collapse" 
    href="#editFields" 
    roe="button">Editor</a>
  <a 
    class="btn" 
    style="background-color:#55aa00;"
    data-bs-toggle="collapse" 
    href="#attributeFields" 
    role="button">Attributes</a>
  <a 
    class="btn" 
    style="background-color:#00aaaa;"
    data-bs-toggle="collapse" 
    href="#relatedFields" 
    role="button">Related</a>
  <a 
    class="btn" 
    style="color:white; background-color:#aa0000;"
    data-bs-toggle="collapse" 
    href="#docFields" 
    role="button">Document</a>
</div>
{% endblock %}

{% block form_action %}#{% endblock %} 
{% block form_method %}POST{% endblock %} 
{% block form_id %}articleEdit{% endblock %}


<!-- begin form fields -->
{% block form_fields %}

<!-- begin doc fields -->
<div 
  class="row collapse multi-collapse b-3 m-3" 
  id="docFields">
  <div class="col-12 rounded p-2" 
    style="color:white; background-color:#aa0000;">Document
  </div>
  {% include 'cmsapp/forms/document_fields.html' %}
</div>
<!-- end doc fields -->

<!-- begin related -->
<div class="row collapse multi-collapse b-3 m-3" 
  id="relatedFields">
  <div class="col-12 rounded p-2" 
    style="color:white; background-color:#00aaaa;">Related
  </div>
[Related fields here]
</div>
<!-- end related -->

<!-- begin attributes -->
<div class="row collapse multi-collapse b-3 m-3" 
  id="attributeFields">
  <div class="col-12 rounded p-2" 
    style="color:white; background-color:#55aa00;">Attributes
  </div>

  <label class="mt-2" for="title">Title</label>
  <input type="text" id="title"></input>
  <label class="mt-2" for="highlight">Highlight</label>
  <select id="highlight" class="form-select" tabindex="3">
    <option value="">Choose one ...</option>
    <option value="xx">XX</option>
    <option value="yy">YY</option>
    <option value="zz">ZZ</option>
  </select>
  <label class="mt-2" for="status">Status</label>
  <select id="status" class="form-select" tabindex="3">
    <option value="">Choose one ...</option>
    <option value="xx">XX</option>
    <option value="yy">YY</option>
    <option value="zz">ZZ</option>
  </select>
  <label class="mt-2" for="author">Authors</label>
  <select id="author" class="chosen-select" multiple>
    <option value="">Choose one or many ...</option>
    <option value="xx">XX</option>
    <option value="yy">YY</option>
  </select>
  <label class="mt-2" for="website">Websites</label>
  <select id="website" multiple class="chosen-select">
    <option value="xx">XX</option>
    <option value="yy">YY</option>
  </select>

</div>
<!-- end attributes -->

<!-- begin editor -->
<div 
  class="row collapse multi-collapse b-3 m-3" 
  id="editFields">
  <div class="col-12 rounded p-2" 
    style="color:white; background-color:#5500aa;">Editor
  </div>
  <!-- editor tabs -->
  <nav>
    <div class="nav nav-tabs mt-3" id="nav-tab" role="tablist">
      <button 
        class="nav-link active" 
        id="nav-home-tab" 
        data-bs-toggle="tab" 
        data-bs-target="#nav-home" 
        type="button" 
        role="tab" 
        aria-controls="nav-home" 
        aria-selected="true">Body</button>
      <button 
        class="nav-link" 
        id="nav-profile-tab" 
        data-bs-toggle="tab" 
        data-bs-target="#nav-profile" 
        type="button" 
        role="tab" 
        aria-controls="nav-profile" 
        aria-selected="false">Excerpt</button>
      <button 
        class="nav-link" 
        id="nav-contact-tab" 
        data-bs-toggle="tab" 
        data-bs-target="#nav-contact" 
        type="button" 
        role="tab" 
        aria-controls="nav-contact" 
        aria-selected="false">Footer</button>
    </div>
  </nav>
  <!-- ckeditor -->
  <div class="tab-content" id="nav-tabContent">
    <div 
      class="tab-pane fade show active" 
      id="nav-home" 
      role="tabpanel" 
      aria-labelledby="nav-home-tab">
      <textarea name="body" id="body"></textarea></div>
    <div 
      class="tab-pane fade" 
      id="nav-profile" 
      role="tabpanel" 
      aria-labelledby="nav-profile-tab">
      <textarea name="excerpt" id="excerpt"></textarea></div>
    <div 
      class="tab-pane fade" 
      id="nav-contact" 
      role="tabpanel" 
      aria-labelledby="nav-contact-tab">
      <textarea name="footer" id="footer"></textarea></div>
  </div>
</div>
<!-- end editor -->

{% endblock %}
<!-- end form fields -->
{% block btn_color %}primary{% endblock %}
{% block btn_value %}Submit{% endblock %}
{% block cancel_url %}#{% endblock %}

{% block script %}
<script type="text/javascript" src="{% static 'js/select2.min.js' %}"></script>
<script> 
function getParentChoices($, pid) {
  $.ajax({
    url: "/cms/get/select/choices",
    data: {
      docType: "article_category",
      sortby: "lexi:ASC",
      choiceID: "ID",
      choiceHuman: "name"
    },
    dataType: "json",
    success: function(response) {

      // Remove all existing options
      $("#parentID").empty();
        
      $("#parentID").append($("<option>", {
        value: "",
        text: "----",
      }));
      // Add new options
      $.each(response, function(index, value) {
        $('#parentID').append($('<option>', {
          value: value[0],
          text: value[1],
        }));
      });
      // Set selection
      if (pid.length > 0) {
          $("#parentID").val(pid).prop("seleted", true);
        } else {
          $("#parentID").val("").prop("selected", true);
        };
    },
    error: function(xhr, status, error) {
        alert('Request was not successful');
    },
  });
};


$(document).ready(function() {
  // opens the editor menu
  $("#editFields").collapse("show")
  $(".chosen-select").select2({
    placeholder: 'Select an option',
    width: '100%',
    });


  $('.clear').removeAttr('value');
  $.ajax({
    url: "/cms/get/document",
    data: {
        doc_id: "{{ docID }}",
    },
    dataType: "json",
    success: function(response) {
      var doc = response;
      // base doc
      $("#ID").val(doc.ID);
      getParentChoices($, "doc.parentID");
      $("#docType").val(doc.docType);
      $("#lexi").val(doc.lexi);
      $("#indx").val(doc.indx);
      $("#createdAt").val(doc.createdAt);
      $("#createdAt").prop("readonly", true);
      $("#updatedAt").val(doc.updatedAt);
      $("#updatedAt").prop("readonly", true);
      $("#schemaVersion").val(doc.schemaVersion);
      // attributes
      $("#title").val(doc.title);
      $("#status").val(doc.status);
      $("#highlight").val(doc.highlight);
      $("#author").val(doc.author);
      $("#website").val(doc.website);
      $("#body").val(doc.body);
      $("#excerpt").val(doc.excerpt);
      $("#footer").val(doc.footer);
    },
  });
  // ckeditor controls
  ClassicEditor
    .create(document.querySelector('#body'))
    .catch(error => {
      console.error(error);
    });
  ClassicEditor
    .create(document.querySelector('#excerpt'))
    .catch( error => {
        console.error( error );
    });
  ClassicEditor
    .create(document.querySelector('#footer'))
    .catch( error => {
        console.error( error );
    });
});




</script>
{% endblock %}
