from .constants import COLLECTION
from django.conf import settings
from django.views.generic import TemplateView, ListView
from homeapp.mixins.breadcrumbs import BrCrumb
from homeapp.mixins.metadata import MetaData
from homeapp.mixins.navigation import Navigation
from svapi_py.api import SvApi

CONF = settings.CONF

class DashboardView(MetaData, BrCrumb, Navigation, TemplateView):
    """Currently redering a simple template."""
    template_name = 'cmsapp/dashboard.html'


class ArticleListView(MetaData, BrCrumb, Navigation, ListView):

    template_name = 'cmsapp/article_list.html'

    def setup(self, request, *args, **kwargs):
        setup = super().setup(request, *args, **kwargs)
        request.session.test_cookie_worked
        apiCred = request.user.apicredentials
        self.headers = {
                'Aid': apiCred.aid,
                'Auth': apiCred.auth,
                'Prefix': apiCred.prefix,
                'Content-Type': 'application/json'
                }
        return setup

    def get_queryset(self):
        svApiUrl = CONF.get('svapi', {}).get('host', '')
        results =  SvApi(svApiUrl, self.headers) \
                .getMany('set', params={
                    'ID': COLLECTION.get('articleCategory', ''),
                    'start': 0,
                    'end': -1
                    })
        return results

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        return context
